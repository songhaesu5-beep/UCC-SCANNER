<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>UCC Scanner</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.9/html5-qrcode.min.js"></script>
  <style>
    #reader {
      width: 100%;
      margin: auto;
      border: 2px dashed #999;
    }
    #reader__scan_region > div {
      width: 600px !important;
      height: 200px !important;
    }
    #feedback {
      font-size: 5em;
      text-align: center;
      margin-top: 30px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="reader"></div>
<div id="feedback"></div>

<script>
const SCAN_URL_BASE = "https://script.google.com/macros/s/AKfycby47A__5YeAq6n04cBzJH_yaFdl4WB96Bqyp5Hg_YDk4shALnFdPlQOmvyk65X_My2kiA/exec?code=";

function startScanner() {
  const qrCodeScanner = new Html5Qrcode("reader");
  qrCodeScanner.start(
    { facingMode: "environment" },
    {
      fps: 10,
      qrbox: { width: 600, height: 200 },
      aspectRatio: 1.77 // 16:9
    },
    (code) => {
      qrCodeScanner.stop().then(() => {
        handleScan(code, qrCodeScanner);
      });
    },
    (error) => {
      console.warn("QR Error:", error);
    }
  ).catch((err) => {
    console.error("Camera init failed:", err);
    document.getElementById("feedback").innerText = "âŒ ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨";
  });
}

function handleScan(code, qrCodeScanner) {
  fetch(SCAN_URL_BASE + encodeURIComponent(code))
    .then(response => response.text())
    .then(result => {
      const feedback = document.getElementById("feedback");
      if (result.includes("âœ“")) {
        feedback.innerHTML = "âœ…";
        feedback.style.color = "green";
      } else if (result.includes("DUP")) {
        feedback.innerHTML = "ðŸ” DUP";
        feedback.style.color = "orange";
      } else {
        feedback.innerHTML = "âŒ";
        feedback.style.color = "red";
      }

      setTimeout(() => {
        feedback.innerHTML = "";
        startScanner();
      }, 1500);
    })
    .catch(() => {
      const feedback = document.getElementById("feedback");
      feedback.innerHTML = "âŒ ERROR";
      feedback.style.color = "red";
      setTimeout(() => {
        feedback.innerHTML = "";
        startScanner();
      }, 1500);
    });
}

startScanner();
</script>

</body>
</html>
